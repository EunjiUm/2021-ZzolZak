{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container">
    <h2 class="main-title">패션지수</h2>
    <div class="row">
        <div class="col-lg-12">
            <div class="chart">
                <canvas id="FashionChart" height="50vh" aria-label="Site statistics" role="img"></canvas>
            </div>
            <div class="chart-detail">
                <h2 style="text-align: center;">아우터는 {{month_1}}월, {{month_2}}월, {{month_3}}월에 입기 좋아요</h2>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-lg-6 d3">
            <!-- d3 그래프 삽입 부분-->
        </div>
        <h2 style="text-align: center;">긍정:{{positive_value}}%, 부정:{{negative_value}}%, 중립:{{neutral_value}}%</h2>
        <div class="col-lg-6">
            <table>
                <thead>
                <tr>
                    <th>감성어</th>
                    <th>언급량</th>
                    <th>분류</th>
                </tr>
                </thead>
                <tbody>
                {% if sent_list %}
                {% for sent in sent_list %}
                <tr class="text-center">
                    <td class="text-center">
                        {{ sent.name }}
                    </td>
                    <td>{{ sent.value}}</td>
                    <td>
                        {{ sent.group }}
                    </td>
                </tr>
                {% endfor %}
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script type="text/javascript">
    var context = document
      .getElementById('FashionChart')
      .getContext('2d');
    var myChart = new Chart(context, {
      type: 'line', // 차트의 형태
      data: { // 차트에 들어갈 데이터
        labels: [
          //x 축
          '1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'
        ],
        datasets: [
          { //데이터
            fill: true, // line 형태일 때, 선 안쪽을 채우는지 안채우는지
            data: [ //x축 label에 대응되는 데이터 값
              {{ Jan }}, {{ Feb }}, {{ Mar }}, {{ Apr }},
              {{ May }}, {{ June }}, {{ July }}, {{ Aug }},
              {{ Sep }}, {{ Oct }}, {{ Nov }}, {{ Dec }},
            ],
            backgroundColor: [
              //색상
              'rgba(255, 99, 132, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(255, 206, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(153, 102, 255, 0.2)',
              'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
              //경계선 색상
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
              'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 2 //경계선 굵기
          }
        ]
      },
      options: {
        resonsive: false,
        scales: {
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
                display: false
              },
              gridLines: {
                drawOnChartArea: false
              }
            }
          ],
          xAxes: [
            {
              ticks: {
                fontSize: 20
              },
              gridLines: {
                drawOnChartArea: false
              }
            }
          ]
        },
        legend: {
          display: false
        },
      }
    });
  </script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
        var graph = {
            "nodes": [
            {% if sent_list %}
            {% for sent in sent_list %}
                { "name": "{{sent.name}}", "value": {{sent.value}}, "group": "{{sent.group}}" },
                // name: 감성어, value: 감성어의 빈도수, group: 긍정/중립/부정 분류
            {% endfor %}
            {% endif %}
            ],
        };
        var width = 1280,
            height = 960;

        var force = d3.layout.force()
            .charge(-1200)
            .size([width, height]);

        var svg = d3.select("div.d3").append("svg")
            .attr("width", width)
            .attr("height", height);

        force
            .nodes(graph.nodes)
            .start();

        var node = svg.selectAll(".node")
            .data(graph.nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", function (d) { return d.value * 10; })
            .style("fill", function (d) {
                if(d.group == "긍정") // 긍정에 대한 색깔
                    return 'rgb(103, 150, 220)';
                else if(d.group == "중립") // 중립에 대한 색깔
                    return 'rgb(151,202,115)';
                else if(d.group == "부정") // 부정에 대한 색깔
                    return 'rgb(252,107,118)';
            })
            .call(force.drag);

        var texts = svg.selectAll("text.label")
            .data(graph.nodes)
            .enter().append("text")
            .attr("class", "label")
            .attr("fill", "white")
            .attr("text-anchor", "middle")
            .attr("font-size", function(d) { return d.value * 3})
            .text(function (d) { return d.name; });

        force.on("tick", function () {

            node.attr("cx", function (d) { return d.x; })
                .attr("cy", function (d) { return d.y; });

            texts.attr("transform", function (d) {
                return "translate(" + d.x + "," + d.y + ")";
            });
        });

    </script>
{% endblock %}